<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airdrop Contract UI</title>
    <style>
        /* Your original CSS remains unchanged - itâ€™s functional */
        body { font-family: 'Roboto', Arial, sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; background-color: #fff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        header { text-align: center; padding: 20px; background-color: #007bff; color: white; border-radius: 10px 10px 0 0; margin-bottom: 20px; }
        header button { padding: 12px 24px; background-color: #28a745; border: none; color: white; cursor: pointer; border-radius: 15px; font-size: 16px; transition: background-color 0.3s; }
        header button:hover { background-color: #218838; }
        nav { margin: 20px 0; text-align: center; }
        nav button { margin: 0 10px; padding: 12px 24px; background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 15px; }
        nav button:hover { background-color: #0056b3; }
        .section { padding: 20px; display: none; }
        .section.active { display: block; }
        input, button { padding: 12px; margin: 5px; border-radius: 5px; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .recipient-row { display: flex; align-items: center; margin-bottom: 10px; }
        #tx-status, #error-message { margin-top: 15px; padding: 12px; background-color: #e9ecef; border-radius: 5px; }
        #error-message.error { background-color: #f8d7da; color: #721c24; }
        .log-content { padding: 15px; background-color: #d4edda; max-height: 200px; overflow-y: auto; display: none; }
        .log-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Airdrop Contract UI (Polygon Amoy)</h1>
            <div class="wallet-status" id="wallet-status">
                <button id="connect-disconnect">Connect MetaMask</button>
                <div id="wallet-status-text" style="display: none; margin-top: 10px;"></div>
            </div>
        </header>
        <nav>
            <button onclick="showSection('home')">Home</button>
            <button onclick="showSection('owner')">Owner's Panel</button>
            <button onclick="showSection('user')">User's Panel</button>
        </nav>
        <div id="home" class="section active">
            <h2>Airdrop Contract Information</h2>
            <p>Contract Address: <span id="hardcoded-address">Not Connected</span></p>
            <div id="contract-info"></div>
            <div id="error-message"></div>
        </div>
        <div id="owner" class="section">
            <h2>Owner's Panel</h2>
            <div id="airdrop-management">
                <div id="recipients">
                    <div class="recipient-row">
                        <input type="text" placeholder="Address">
                        <input type="number" placeholder="Amount (Tokens)" step="0.1">
                        <button onclick="removeRecipient(this)">Remove</button>
                    </div>
                </div>
                <button onclick="addRecipient()">Add Recipient</button>
                <button onclick="performAirdrop()">Perform Airdrop</button>
            </div>
            <div id="tx-status"></div>
            <div id="error-message" class="error"></div>
        </div>
        <div id="user" class="section">
            <h2>User's Panel</h2>
            <button onclick="checkBalance()">Check Balance</button>
            <div id="balance-result"></div>
            <div id="error-message" class="error"></div>
        </div>
        <div id="admin-logs" class="log-content active"></div>
    </div>

    <!-- Load Web3 with fallback -->
    <script src="https://unpkg.com/web3@1.10.4/dist/web3.min.js" onerror="console.error('Web3 CDN failed. Please download web3.min.js locally.')"></script>
    <script>
        // Ensure DOM is ready and Web3 is available
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.Web3) {
                logAdmin("Error: Web3 library not loaded. Check CDN or host locally.");
                alert("Web3 library failed to load. Please check your network or use a local copy.");
                return;
            }

            // Core variables
            const CONTRACT_ADDRESS = "0x71d8cc90b62ee78c3a9374e9a8f0ec46e34e22e5";
            const TOKEN_ADDRESS = "0x9a15aca3b949b057ff7c99df82675a4e3f4b553d";
            let web3, contract, tokenContract, userAddress;

            // Logging function
            function logAdmin(message) {
                const logDiv = document.getElementById('admin-logs');
                logDiv.innerHTML += `<p>[${new Date().toLocaleTimeString()}] ${message}</p>`;
                logDiv.scrollTop = logDiv.scrollHeight;
            }

            // Error display
            function showError(section, message) {
                const errorDiv = document.querySelector(`#${section} #error-message`) || document.getElementById('error-message');
                errorDiv.textContent = message;
                errorDiv.classList.add('error');
                setTimeout(() => errorDiv.classList.remove('error'), 5000);
                logAdmin(`Error in ${section}: ${message}`);
            }

            // Wallet connection
            async function connectWallet() {
                try {
                    if (!window.ethereum) throw new Error("MetaMask not detected");
                    web3 = new Web3(window.ethereum);
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    userAddress = accounts[0];
                    const chainId = await web3.eth.getChainId();
                    if (chainId !== 80002) {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x13882' }]
                        });
                    }
                    contract = new web3.eth.Contract([
                        {"inputs":[{"internalType":"address","name":"tokenAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},
                        {"inputs":[{"internalType":"address[]","name":"hunters","type":"address[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"}],"name":"airdrop","outputs":[],"stateMutability":"nonpayable","type":"function"},
                        {"inputs":[],"name":"getBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
                    ], CONTRACT_ADDRESS);
                    tokenContract = new web3.eth.Contract([
                        "function symbol() view returns (string)",
                        "function balanceOf(address) view returns (uint256)"
                    ], TOKEN_ADDRESS);
                    const symbol = await tokenContract.methods.symbol().call();
                    document.getElementById('wallet-status-text').textContent = `Connected: ${userAddress}`;
                    document.getElementById('wallet-status-text').style.display = 'block';
                    document.getElementById('connect-disconnect').textContent = "Disconnect";
                    document.getElementById('hardcoded-address').textContent = CONTRACT_ADDRESS;
                    logAdmin("Wallet connected: " + userAddress);
                } catch (error) {
                    showError('header', "Connection failed: " + error.message);
                }
            }

            // Disconnect wallet
            function disconnectWallet() {
                userAddress = null;
                contract = null;
                tokenContract = null;
                document.getElementById('wallet-status-text').style.display = 'none';
                document.getElementById('connect-disconnect').textContent = "Connect MetaMask";
                document.getElementById('hardcoded-address').textContent = "Not Connected";
                logAdmin("Wallet disconnected");
            }

            // Wallet button handler
            document.getElementById('connect-disconnect').addEventListener('click', () => {
                if (userAddress) disconnectWallet();
                else connectWallet();
            });

            // Panel navigation
            function showSection(sectionId) {
                document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                document.getElementById(sectionId).classList.add('active');
                logAdmin("Switched to section: " + sectionId);
            }

            // Airdrop functions
            function addRecipient() {
                const row = document.createElement('div');
                row.className = 'recipient-row';
                row.innerHTML = `<input type="text" placeholder="Address"><input type="number" placeholder="Amount (Tokens)" step="0.1"><button onclick="removeRecipient(this)">Remove</button>`;
                document.getElementById('recipients').appendChild(row);
            }

            function removeRecipient(button) {
                button.parentElement.remove();
            }

            async function performAirdrop() {
                if (!contract) return showError('owner', 'Connect wallet first');
                try {
                    const hunters = Array.from(document.querySelectorAll('#recipients input[type="text"]')).map(input => input.value.trim());
                    const amounts = Array.from(document.querySelectorAll('#recipients input[type="number"]')).map(input => web3.utils.toWei(input.value || "0", 'ether'));
                    const tx = await contract.methods.airdrop(hunters, amounts).send({ from: userAddress });
                    document.getElementById('tx-status').innerHTML = `Success! Tx: <a href="https://amoy.polygonscan.com/tx/${tx.transactionHash}" target="_blank">${tx.transactionHash}</a>`;
                    logAdmin("Airdrop successful: " + tx.transactionHash);
                } catch (error) {
                    showError('owner', "Airdrop failed: " + error.message);
                }
            }

            // Balance check
            async function checkBalance() {
                if (!tokenContract) return showError('user', 'Connect wallet first');
                try {
                    const bal = await tokenContract.methods.balanceOf(userAddress).call();
                    const symbol = await tokenContract.methods.symbol().call();
                    document.getElementById('balance-result').textContent = `Balance: ${web3.utils.fromWei(bal, 'ether')} ${symbol}`;
                    logAdmin("Balance checked: " + userAddress);
                } catch (error) {
                    showError('user', "Balance check failed: " + error.message);
                }
            }

            // Initial log
            logAdmin("Page loaded successfully");
        });
    </script>
</body>
</html>
