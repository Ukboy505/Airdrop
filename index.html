<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Airdrop Contract UI</title><style>body{font-family:'Roboto',Arial,sans-serif;margin:0;padding:0;background-color:#f5f5f5;line-height:1.6}.container{max-width:1200px;margin:0 auto;padding:20px;background-color:#fff;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.1)}header{text-align:center;padding:20px;background-color:#007bff;color:white;border-radius:10px 10px 0 0;margin-bottom:20px}header .wallet-status{margin-top:10px}header button{padding:12px 24px;background-color:#28a745;border:none;color:white;cursor:pointer;border-radius:15px;font-size:16px;transition:background-color .3s;box-shadow:0 2px 5px rgba(0,0,0,.2)}header button:hover{background-color:#218838}nav{margin:20px 0;text-align:center;background-color:#e9ecef;padding:10px;border-radius:5px}nav button{margin:0 10px;padding:12px 24px;background-color:#007bff;color:white;border:none;cursor:pointer;border-radius:15px;font-size:16px;transition:background-color .3s;box-shadow:0 2px 5px rgba(0,0,0,.2)}nav button:hover{background-color:#0056b3}.section{padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.05);margin-bottom:20px;display:none}.section.active{display:block}.section h2{color:#007bff;margin-bottom:15px}.section h3,.section h4{color:#333;margin-top:15px;margin-bottom:10px}input,button{padding:12px;margin:5px;border-radius:5px;border:1px solid #ccc;font-size:16px}button{background-color:#007bff;color:white;border:none;cursor:pointer;transition:background-color .3s;box-shadow:0 2px 5px rgba(0,0,0,.2)}button:hover{background-color:#0056b3}.recipient-row{display:flex;align-items:center;margin-bottom:10px}.recipient-row input{flex:1;margin-right:10px}#tx-status,#error-message{margin-top:15px;padding:12px;background-color:#e9ecef;border-radius:5px;font-size:14px}#error-message.error{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.wallet-instructions{margin:10px 0;padding:12px;background-color:#d4edda;border:1px solid #c3e6cb;border-radius:5px;text-align:left;font-size:14px}.log-tabs{display:flex;margin-top:20px;background-color:#e9ecef;border-radius:5px 5px 0 0}.log-tab{padding:12px 24px;background-color:#ddd;cursor:pointer;border-radius:15px 15px 0 0;margin-right:5px;font-size:16px;transition:background-color .3s;box-shadow:0 2px 5px rgba(0,0,0,.2)}.log-tab.active{background-color:#007bff;color:white}.log-tab:hover{background-color:#ccc}.log-content{padding:15px;background-color:#d4edda;color:#155724;border:1px solid #c3e6cb;border-radius:0 5px 5px 5px;max-height:200px;overflow-y:auto;display:none}.log-content.active,.log-content.error{display:block}.log-content.error{background-color:#f8d7da;color:#721c24;border-color:#f5c6cb}@media (max-width:600px){.recipient-row{flex-direction:column}input,button{width:100%}nav button,.log-tab{margin:5px 0;width:100%}}table{width:100%;border-collapse:collapse;margin-top:10px}th,td{padding:8px;border:1px solid #ddd;text-align:left}th{background-color:#007bff;color:white}</style></head><body><div class="container"><header><h1>Airdrop Contract UI (Polygon Amoy)</h1><div class="wallet-status" id="wallet-status"><button id="connect-disconnect">Connect MetaMask</button><div id="wallet-instructions" class="wallet-instructions" style="display:none;"></div><div id="wallet-status-text" style="display:none;margin-top:10px;"></div></div></header><nav><button onclick="showSection('home')">Home</button><button onclick="showSection('owner')">Owner's Panel</button><button onclick="showSection('user')">User's Panel</button></nav><div id="home" class="section active"><h2>Airdrop Contract Information</h2><p>Contract Address: <span id="hardcoded-address">Not Connected</span></p><div id="contract-info"></div><div id="error-message"></div></div><div id="owner" class="section"><h2>Owner's Panel</h2><div id="airdrop-management"><h3>Airdrop Management</h3><h4>Manual Input</h4><div id="recipients"><div class="recipient-row"><input type="text" placeholder="Address"><input type="number" placeholder="Amount (Tokens, e.g., 1 for 1 wei)" step="0.1"><button onclick="removeRecipient(this)">Remove</button></div></div><button onclick="addRecipient()">Add Recipient</button><p>Total: <span id="total-amount">0</span> Tokens</p><button onclick="performAirdrop()">Perform Airdrop</button><h4>Batch Input (Comma-Separated)</h4><input type="text" id="batch-input" placeholder="Address1,Amount1,Address2,Amount2,..."><button onclick="performBatchAirdrop()">Airdrop from Batch</button><h4>CSV Upload</h4><input type="file" id="csv-upload" accept=".csv" onchange="processCSV(this.files[0])"><button onclick="performCSVAirdrop()">Airdrop from CSV</button><button onclick="removeCSV()">Remove CSV</button></div><div class="pause-unpause"><h3>Contract Status</h3><p>Status: <span id="contract-status">Unknown</span></p><button onclick="togglePause()">Toggle Pause</button></div><div class="withdraw"><h3>Withdraw Tokens</h3><input type="number" id="withdraw-amount" placeholder="Amount (Tokens, e.g., 1 for 1 wei)" step="0.1"><button onclick="withdrawTokens()">Withdraw</button></div><div id="tx-status"></div><div id="error-message" class="error"></div></div><div id="user" class="section"><h2>User's Panel</h2><input type="text" id="check-address" placeholder="Enter address (leave blank for connected wallet)"><button onclick="checkBalance()">Check Balance</button><div id="balance-result"></div><h3>Transfer Tokens</h3><input type="text" id="transfer-to" placeholder="Recipient Address"><input type="number" id="transfer-amount" placeholder="Amount (Tokens, e.g., 1 for 1 wei)" step="0.1"><button onclick="transferTokens()">Transfer</button><div id="error-message" class="error"></div></div><div class="log-tabs"><div class="log-tab active" onclick="showLogTab('admin-logs')">Admin Logs</div><div class="log-tab" onclick="showLogTab('user-logs')">User Logs</div></div><div id="admin-logs" class="log-content active"></div><div id="user-logs" class="log-content"></div></div><script src="https://unpkg.com/web3@1.10.4/dist/web3.min.js"></script><script>function logAdmin(m){const l=document.getElementById('admin-logs');l.innerHTML+=`<p class="${m.includes('Error')||m.includes('failed')?'error':'active'}">${new Date().toLocaleTimeString()} - ${m}</p>`}function logUser(m){const l=document.getElementById('user-logs');l.innerHTML+=`<p class="${m.includes('Error')||m.includes('failed')?'error':'active'}">${new Date().toLocaleTimeString()} - ${m}</p>`}function showLogTab(t){document.querySelectorAll('.log-tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.log-content').forEach(c=>c.classList.remove('active'));document.querySelector(`.log-tab[onclick="showLogTab('${t}')"]`).classList.add('active');document.getElementById(t).classList.add('active')}function showError(s,m){const e=document.getElementById('error-message')||document.querySelector(`#${s} #error-message`);if(e){e.textContent=m;e.classList.add('error');setTimeout(()=>e.classList.remove('error'),5000)}if(s==='owner'||s==='home')logAdmin(`Error in ${s}: ${m}`);else logUser(`Error in ${s}: ${m}`)}const CONTRACT_ADDRESS="0x71d8cc90b62ee78c3a9374e9a8f0ec46e34e22e5";const TOKEN_ADDRESS="0x9a15aca3b949b057ff7c99df82675a4e3f4b553d";let web3,contract,tokenContract,userAddress,contractBalance='0',isPaused=false,tokenSymbol='';async function getGasPrice(){try{return await web3.eth.getGasPrice()}catch(e){logAdmin("Error fetching gas price: "+e.message);return web3.utils.toWei('20','gwei')}}document.getElementById('connect-disconnect').addEventListener('click',async()=>{if(userAddress){userAddress=null;contract=null;tokenContract=null;document.getElementById('wallet-status').innerHTML=`<button id="connect-disconnect">Connect MetaMask</button><div id="wallet-instructions" class="wallet-instructions" style="display:none;"></div>`;document.getElementById('wallet-status-text').style.display='none';document.getElementById('hardcoded-address').textContent='Not Connected';document.getElementById('contract-info').innerHTML='';document.getElementById('contract-status').textContent='Unknown';document.getElementById('tx-status').textContent='';document.getElementById('balance-result').innerHTML='';document.getElementById('admin-logs').innerHTML='';document.getElementById('user-logs').innerHTML='';logAdmin("Wallet disconnected");document.getElementById('connect-disconnect').style.backgroundColor='#28a745';document.getElementById('connect-disconnect').addEventListener('click',connectWalletHandler,{once:true});return}logAdmin("Connecting wallet...");const isMobile=/mobile|android|iphone|ipad/.test(navigator.userAgent.toLowerCase());if(window.ethereum){try{web3=new Web3(window.ethereum);await window.ethereum.request({method:'eth_requestAccounts'});const accounts=await web3.eth.getAccounts();userAddress=accounts[0];const chainId=await web3.eth.getChainId();if(chainId!==80002){try{await window.ethereum.request({method:'wallet_switchEthereumChain',params:[{chainId:'0x13882'}]})}catch(switchError){if(switchError.code===4902)await window.ethereum.request({method:'wallet_addEthereumChain',params:[{chainId:'0x13882',chainName:'Polygon Amoy',rpcUrls:['https://rpc-amoy.polygon.technology/'],nativeCurrency:{name:'MATIC',symbol:'MATIC',decimals:18},blockExplorerUrls:['https://amoy.polygonscan.com/']}]);else throw switchError}}contract=new web3.eth.Contract([{"inputs":[{"internalType":"address","name":"tokenAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address[]","name":"hunters","type":"address[]"},{"indexed":false,"internalType":"uint256[]","name":"amounts","type":"uint256[]"}],"name":"Success","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Withdrawn","type":"event"},{"inputs":[{"internalType":"address[]","name":"hunters","type":"address[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"}],"name":"airdrop","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"token","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalDistributed","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}],CONTRACT_ADDRESS);tokenContract=new web3.eth.Contract([{"inputs":[{"internalType":"uint256","name":"initialSupply","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"allowance","type":"uint256"},{"internalType":"uint256","name":"needed","type":"uint256"}],"name":"ERC20InsufficientAllowance","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"uint256","name":"needed","type":"uint256"}],"name":"ERC20InsufficientBalance","type":"error"},{"inputs":[{"internalType":"address","name":"approver","type":"address"}],"name":"ERC20InvalidApprover","type":"error"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC20InvalidReceiver","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"}],"name":"ERC20InvalidSender","type":"error"},{"inputs":[{"internalType":"address","name":"spender","type":"address"}],"name":"ERC20InvalidSpender","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}],TOKEN_ADDRESS);const[name,symbol,balance,total,paused]=await Promise.all([tokenContract.methods.name().call(),tokenContract.methods.symbol().call(),contract.methods.getBalance().call(),contract.methods.totalDistributed().call(),contract.methods.paused().call()]);contractBalance=web3.utils.fromWei(balance,'wei');isPaused=paused;tokenSymbol=symbol;document.getElementById('wallet-status').innerHTML=`<button id="connect-disconnect" style="background-color:#007bff">Disconnect</button><div id="wallet-instructions" class="wallet-instructions" style="display:none;"></div>`;document.getElementById('wallet-status-text').textContent='Wallet Connected';document.getElementById('wallet-status-text').style.display='block';document.getElementById('wallet-status-text').style.color='#007bff';document.getElementById('connected-address').textContent=`Connected Address: ${userAddress}`;document.getElementById('connected-address').style.display='block';document.getElementById('hardcoded-address').textContent=CONTRACT_ADDRESS;document.getElementById('contract-info').innerHTML=`<p>Token Name: ${name}</p><p>Token Symbol: ${symbol}</p><p>Contract Balance: ${contractBalance} ${symbol}</p><p>Total Distributed: ${web3.utils.fromWei(total,'wei')} ${symbol}</p><p>Contract Status: ${paused?'Paused':'Unpaused'}</p>`;document.getElementById('contract-status').textContent=paused?'Paused':'Unpaused';document.getElementById('wallet-instructions').style.display='none';logAdmin("Wallet connected and contracts loaded: "+CONTRACT_ADDRESS);contract.events.Success({fromBlock:'latest'}).on('data',e=>logAdmin(`Airdrop Success: ${e.returnValues.hunters.length} recipients`)).on('error',e=>logAdmin("Success event error: "+e.message));contract.events.Paused({fromBlock:'latest'}).on('data',e=>logAdmin(`Contract Paused by ${e.returnValues.account}`)).on('error',e=>logAdmin("Paused event error: "+e.message));contract.events.Unpaused({fromBlock:'latest'}).on('data',e=>logAdmin(`Contract Unpaused by ${e.returnValues.account}`)).on('error',e=>logAdmin("Unpaused event error: "+e.message));contract.events.Withdrawn({fromBlock:'latest'}).on('data',e=>logAdmin(`Withdrawn ${web3.utils.fromWei(e.returnValues.amount,'wei')} by ${e.returnValues.owner}`)).on('error',e=>logAdmin("Withdrawn event error: "+e.message));tokenContract.events.Transfer({filter:{from:userAddress},fromBlock:'latest'}).on('data',e=>{logUser(`Transfer: ${web3.utils.fromWei(e.returnValues.value,'wei')} ${tokenSymbol} from ${e.returnValues.from} to ${e.returnValues.to}`)}).on('error',e=>logUser("Transfer event error: "+e.message));document.getElementById('connect-disconnect').addEventListener('click',connectWalletHandler,{once:true})}catch(e){logAdmin("Connection error: "+e.message);showError('header',"Failed to connect wallet: "+e.message)}}else if(isMobile){const c=window.location.href;window.location.href=`metamask://dapp/${c}`;setTimeout(()=>{if(!window.ethereum)showWalletInstructions(isMobile,c)},2000)}else showWalletInstructions(isMobile)});function connectWalletHandler(){document.getElementById('connect-disconnect').click()}function showWalletInstructions(i,u=window.location.href){const w=document.getElementById('wallet-instructions');w.style.display='block';w.innerHTML=i?`<p>MetaMask not detected. Open this in the MetaMask app:</p><ol><li>Install MetaMask from App Store/Google Play</li><li>Tap browser icon</li><li>Paste: <strong>${u}</strong></li></ol>`:`<p>Please install MetaMask from <a href="https://metamask.io" target="_blank">metamask.io</a>.</p>`;logAdmin("Showing wallet instructions")}function showSection(s){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));document.getElementById(s).classList.add('active');logAdmin("Showing section: "+s)}function addRecipient(){try{const r=document.createElement('div');r.className='recipient-row';r.innerHTML=`<input type="text" placeholder="Address"><input type="number" placeholder="Amount (Tokens, e.g., 1 for 1 wei)" step="0.1"><button onclick="removeRecipient(this)">Remove</button>`;document.getElementById('recipients').appendChild(r);updateTotal()}catch(e){showError('owner',"Error adding recipient: "+e.message);logAdmin("Error adding recipient: "+e.message)}}function removeRecipient(b){try{b.parentElement.remove();updateTotal()}catch(e){showError('owner',"Error removing recipient: "+e.message);logAdmin("Error removing recipient: "+e.message)}}function updateTotal(){try{const a=Array.from(document.querySelectorAll('#recipients input[type="number"]')).map(i=>parseFloat(i.value)||0);const t=a.reduce((s,v)=>s+v,0);document.getElementById('total-amount').textContent=t.toFixed(2)}catch(e){showError('owner',"Error calculating total: "+e.message);logAdmin("Error calculating total: "+e.message)}}async function performAirdrop(){if(!contract)return showError('owner','Please connect your wallet and contract first!');try{const h=Array.from(document.querySelectorAll('#recipients input[type="text"]')).map(i=>i.value.trim());const a=Array.from(document.querySelectorAll('#recipients input[type="number"]')).map(i=>{const v=parseFloat(i.value)||0;if(isNaN(v)||v<=0)throw new Error(`Invalid amount: ${i.value}`);return web3.utils.toWei(v.toString(),'wei')});if(h.length!==a.length)throw new Error('Mismatch between addresses and amounts');if(h.some(h=>!web3.utils.isAddress(h)))throw new Error('One or more addresses are invalid');const t=parseFloat(document.getElementById('total-amount').textContent);if(t>parseFloat(contractBalance))throw new Error('Total exceeds contract balance');const g=await getGasPrice();document.getElementById('tx-status').textContent='Pending...';const tx=await contract.methods.airdrop(h,a).send({from:userAddress,gasPrice:g});document.getElementById('tx-status').innerHTML=`Success! Tx: <a href="https://amoy.polygonscan.com/tx/${tx.transactionHash}" target="_blank">${tx.transactionHash}</a> at ${new Date().toLocaleString()}`;logAdmin("Airdrop successful: "+tx.transactionHash);updateContractInfo()}catch(e){document.getElementById('tx-status').textContent='';showError('owner',"Airdrop failed: "+e.message);logAdmin("Airdrop error: "+e.message)}}async function processCSV(f){if(!f)return showError('owner','Please select a CSV file');try{const r=new FileReader();r.onload=e=>{const t=e.target.result,l=t.split('\n').map(l=>l.trim()).filter(l=>l),d=document.getElementById('recipients');d.innerHTML='';l.forEach(l=>{const[a,m]=l.split(',').map(i=>i.trim());if(a&&m&&web3.utils.isAddress(a)&&!isNaN(parseFloat(m))&&parseFloat(m)>0){const r=document.createElement('div');r.className='recipient-row';r.innerHTML=`<input type="text" value="${a}" placeholder="Address"><input type="number" value="${m}" placeholder="Amount (Tokens, e.g., 1 for 1 wei)" step="0.1"><button onclick="removeRecipient(this)">Remove</button>`;d.appendChild(r)}else throw new Error(`Invalid CSV line: ${l}`)});updateTotal();logAdmin("CSV processed with "+l.length+" entries")};r.readAsText(f)}catch(e){showError('owner',"CSV processing error: "+e.message);logAdmin("CSV processing error: "+e.message)}}async function performCSVAirdrop(){performAirdrop()}async function performBatchAirdrop(){if(!contract)return showError('owner','Please connect your wallet and contract first!');try{const b=document.getElementById('batch-input').value.trim(),p=b.split(',').map(i=>i.trim()).filter(i=>i);if(p.length%2!==0)throw new Error('Invalid batch input format. Use: Address1,Amount1,Address2,Amount2,...');const h=[],a=[];for(let i=0;i<p.length;i+=2){const d=p[i],v=parseFloat(p[i+1])||0;if(!web3.utils.isAddress(d))throw new Error(`Invalid address: ${d}`);if(v<=0)throw new Error(`Invalid amount: ${v}`);h.push(d);a.push(web3.utils.toWei(v.toString(),'wei'))}const t=h.reduce((s,_,i)=>s+parseFloat(web3.utils.fromWei(a[i],'wei')),0);if(t>parseFloat(contractBalance))throw new Error('Total exceeds contract balance');const g=await getGasPrice();document.getElementById('tx-status').textContent='Pending...';const tx=await contract.methods.airdrop(h,a).send({from:userAddress,gasPrice:g});document.getElementById('tx-status').innerHTML=`Success! Tx: <a href="https://amoy.polygonscan.com/tx/${tx.transactionHash}" target="_blank">${tx.transactionHash}</a> at ${new Date().toLocaleString()}`;logAdmin("Batch airdrop successful: "+tx.transactionHash);updateContractInfo()}catch(e){document.getElementById('tx-status').textContent='';showError('owner',"Batch airdrop failed: "+e.message);logAdmin("Batch airdrop error: "+e.message)}}async function togglePause(){if(!contract)return showError('owner','Please connect your wallet and contract first!');try{document.getElementById('tx-status').textContent='Pending...';const m=isPaused?contract.methods.unpause():contract.methods.pause(),g=await getGasPrice(),tx=await m.send({from:userAddress,gasPrice:g});isPaused=!isPaused;document.getElementById('contract-status').textContent=isPaused?'Paused':'Unpaused';document.getElementById('tx-status').innerHTML=`Success! Tx: <a href="https://amoy.polygonscan.com/tx/${tx.transactionHash}" target="_blank">${tx.transactionHash}</a> at ${new Date().toLocaleString()}`;logAdmin("Pause toggled: "+(isPaused?'Paused':'Unpaused'));updateContractInfo()}catch(e){document.getElementById('tx-status').textContent='';showError('owner',"Toggle pause failed: "+e.message);logAdmin("Toggle pause error: "+e.message)}}async function withdrawTokens(){if(!contract)return showError('owner','Please connect your wallet and contract first!');const a=document.getElementById('withdraw-amount').value;if(!a||parseFloat(a)<=0)return showError('owner','Invalid amount!');try{document.getElementById('tx-status').textContent='Pending...';const g=await getGasPrice(),tx=await contract.methods.withdraw(web3.utils.toWei(a.toString(),'wei')).send({from:userAddress,gasPrice:g});document.getElementById('tx-status').innerHTML=`Success! Tx: <a href="https://amoy.polygonscan.com/tx/${tx.transactionHash}" target="_blank">${tx.transactionHash}</a> at ${new Date().toLocaleString()}`;logAdmin("Withdraw successful: "+tx.transactionHash);updateContractInfo()}catch(e){document.getElementById('tx-status').textContent='';showError('owner',"Withdraw failed: "+e.message);logAdmin("Withdraw error: "+e.message)}}async function checkBalance(){if(!tokenContract)return showError('user','Please connect your wallet and contract first!');const a=document.getElementById('check-address').value.trim()||userAddress;if(!web3.utils.isAddress(a))return showError('user','Invalid address!');try{const d=await tokenContract.methods.decimals().call(),b=await tokenContract.methods.balanceOf(a).call(),f=(b/Math.pow(10,d)).toFixed(d);document.getElementById('balance-result').innerHTML=`Balance: ${f} ${tokenSymbol} (Decimals: ${d})`;logUser("Balance checked for: "+a+" - "+f+" "+tokenSymbol)}catch(e){showError('user',"Balance check failed: "+e.message);logUser("Balance check error: "+e.message)}}async function transferTokens(){if(!tokenContract)return showError('user','Please connect your wallet and contract first!');const t=document.getElementById('transfer-to').value.trim(),a=document.getElementById('transfer-amount').value;if(!web3.utils.isAddress(t))return showError('user','Invalid recipient address!');if(!a||parseFloat(a)<=0)return showError('user','Invalid amount!');try{const d=await tokenContract.methods.decimals().call(),v=Math.floor(parseFloat(a)*Math.pow(10,d)),g=await getGasPrice(),tx=await tokenContract.methods.transfer(t,v.toString()).send({from:userAddress,gasPrice:g});logUser(`Transfer successful: ${a} ${tokenSymbol} to ${t} - Tx: <a href="https://amoy.polygonscan.com/tx/${tx.transactionHash}" target="_blank">${tx.transactionHash}</a>`);checkBalance()}catch(e){showError('user',"Transfer failed: "+e.message);logUser("Transfer error: "+e.message)}}async function updateContractInfo(){if(contract){try{const[b,t,p]=await Promise.all([contract.methods.getBalance().call(),contract.methods.totalDistributed().call(),contract.methods.paused().call()]);contractBalance=web3.utils.fromWei(b,'wei');isPaused=p;const n=await tokenContract.methods.name().call(),s=await tokenContract.methods.symbol().call();document.getElementById('contract-info').innerHTML=`<p>Token Name: ${n}</p><p>Token Symbol: ${s}</p><p>Contract Balance: ${contractBalance} ${s}</p><p>Total Distributed: ${web3.utils.fromWei(t,'wei')} ${s}</p><p>Contract Status: ${p?'Paused':'Unpaused'}</p>`;document.getElementById('contract-status').textContent=p?'Paused':'Unpaused'}catch(e){showError('home',"Error updating contract info: "+e.message);logAdmin("Error updating contract info: "+e.message)}}}function removeCSV(){document.getElementById('recipients').innerHTML=`<div class="recipient-row"><input type="text" placeholder="Address"><input type="number" placeholder="Amount (Tokens, e.g., 1 for 1 wei)" step="0.1"><button onclick="removeRecipient(this)">Remove</button></div>`;updateTotal();logAdmin("CSV removed")};logAdmin("Page loaded");document.getElementById('connect-disconnect').addEventListener('click',connectWalletHandler,{once:true});</script></body></html>
